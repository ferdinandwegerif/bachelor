<!DOCTYPE html>
<html lang="en">
<!-- Utilizing componenets to expand the form application -->

<head>
    <title>Registration</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app" class="container">
        <tab-list>
            <page-tab v-bind:selected="true" name="Registration">
                <h4 class="display-4">Registration with Vue</h1>

                    <form action="" method="POST" @submit="checkForm">

                        <!-- First name and last name -->
                        <div class="row">
                            <div class="col">
                                <div class="form-group">
                                    <label for="firstname">First Name</label>
                                    <input type="text" v-model="firstname" placeholder="First Name" class="form-control"
                                        id="firstname">
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-group">
                                    <label for="lastname">Last Name</label>
                                    <input type="text" v-model="lastname" placeholder="Last Name" class="form-control"
                                        id="lastname">
                                </div>
                            </div>
                        </div>

                        <!-- Username -->
                        <div class="form-group">
                            <label for="">Username</label>
                            <input type="text" v-model="username" placeholder="Username" class="form-control">
                        </div>

                        <!-- Password -->
                        <div class="form-group">
                            <label for="">Password</label>
                            <input type="password" v-model="password" placeholder="Password" class="form-control">
                        </div>

                        <!-- Email -->
                        <div class="form-group">
                            <label for="">E-mail</label>
                            <input type="text" v-model="email" placeholder="E-mail" class="form-control">
                        </div>

                        <!-- Gender -->
                        <div class="form-group">
                            <label for="">Gender</label><br>

                            <select name="gender" id="" v-model="gender" class="form-control">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>

                        <div class="field form-group">
                            <input type="submit" value="Submit">
                        </div>

                    </form>

                    <div id="values" v-if="success">
                        <h3>Current values</h3>
                        <div>First Name: {{ firstname }}</div>
                        <div>Last Name: {{ lastname }}</div>
                        <div>Username: {{ username }}</div>
                        <div>Password: {{ password }}</div>
                        <div>E-mail: {{ email }}</div>
                        <div>Gender: {{ gender }}</div>
                    </div>

                    <div id="errors" v-if="errors.length > 0">
                        <p>Please correct errors below.</p>
                        <ul>
                            <li v-for="error in errors">{{ error }}</li>
                        </ul>
                    </div>
            </page-tab>

            <page-tab name="Profiles">
                <div class="profilepage">
                    <div class="profile" v-for="user in users">
                    <user-profile v-bind:gender="user.gender" v-bind:firstname="user.firstname"
                        v-bind:lastname="user.lastname" v-bind:username="user.username" v-bind:password="user.password"
                        v-bind:email="user.email">
                    </user-profile>
                </div>
                </div>
            </page-tab>
        </tab-list>
    </div>
</body>

</html>

<script type="text/javascript">
    let all_tabs = Vue.component('tab-list', {
        data: function () {
            return {
                tabs: []
            }
        },
        created: function () {
            this.tabs = this.$children;
        },
        template: 
        '<div>\
            <header class="tabs">\
                <ul class="navigation">\
                    <li v-for="(tab, index) in this.tabs" :key="index">\
                        <div class="nav-item"\
                            v-bind:class="{ active: tab.active }"\
                             @click="selectTab(tab)">\
                            {{ tab.name }}\
                        </div>\
                    </li>\
                </ul>\
            </header>\
            <main class="tab-details">\
                <slot></slot>\
            </main>\
        </div>',
        methods:{
            selectTab: function(selectedTab){
                this.tabs.forEach(tab => {
                    tab.active = tab.name === selectedTab.name;
                });
            }
        }
    })
    let page_tab = Vue.component('page-tab', {
        props: {
            name: String,
            selected: {
                type: Boolean,
                default: false
            }
        },
        template:
        '<div v-show="active">\
            <slot></slot>\
        </div>',
        data: function () {
            return {
                active: false
            }
        },
        mounted: function () {
            this.active = this.selected
        }
    })

    let user_profile = Vue.component('user-profile', {
        props: {
            firstname: String,
            lastname: String,
            username: String,
            password: String,
            email: String,
            gender: String
        },
        template: 
        '<div class="profile_box" v-bind:class="gender">\
            <h3>{{ firstname }} {{ lastname }}</h3>\
            <p>Username: {{ username }}</p>\
        </div>'
    })

    let app = new Vue({
        el: '#app',
        data: {
            errors: [],
            firstname: null,
            lastname: null,
            username: null,
            password: null,
            email: null,
            gender: null,
            success: false,
            /* Default Users initialized for testing purposes*/
            users: [{
                    firstname: "John",
                    lastname: "Doe",
                    username: "JDoe47",
                    password: "12321",
                    email: "john.doe@gmail.com",
                    gender: "male"
                },
                {
                    firstname: "Mark",
                    lastname: "Test",
                    username: "Mark12321",
                    password: "123456",
                    email: "mark.test@gmail.com",
                    gender: "male"
                }
            ]
        },
        components: {
            'profile': user_profile,
            'page_tab': page_tab
        },
        methods: {
            checkForm: function (e) {
                this.errors = [];
                this.success = false;

                if (!this.firstname) {
                    this.errors.push("Requires First Name.")
                }

                if (!this.lastname) {
                    this.errors.push("Requires Last Name.")
                }

                if (!this.username) {
                    this.errors.push("Requires username.")
                }
                if (!this.password) {
                    this.errors.push("Requires password.")
                }
                if (!this.email) {
                    this.errors.push("Requires email.")
                }
                if (!this.gender) {
                    this.errors.push("Requires gender.")
                }

                if (this.errors.length == 0) {
                    alert("Success!");
                    this.success = true
                    this.users.push({
                        firstname: this.firstname,
                        lastname: this.lastname,
                        username: this.username,
                        password: this.password,
                        email: this.email,
                        gender: this.gender
                    });
                    this.resetForm()
                }
                e.preventDefault()
            },
            resetForm: function () {
                this.errors = []
                this.firstname = null
                this.lastname = null
                this.username = null
                this.password = null
                this.email = null
                this.gender = null
                this.success = false
            }
        }

    })
</script>